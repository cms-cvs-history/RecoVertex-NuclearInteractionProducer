include "TrackingTools/TrackFitters/data/KFTrajectoryFitterESProducer.cfi"
include "TrackingTools/TransientTrack/data/TransientTrackBuilder.cfi"

#Magnetic Field and Geometry
include "MagneticField/Engine/data/volumeBasedMagneticField.cfi"
include "Geometry/CMSCommonData/data/cmsIdealGeometryXML.cfi"
include "Geometry/CommonDetUnit/data/globalTrackingGeometry.cfi"

# NavigationSchool
include "RecoTracker/TkNavigation/data/NavigationSchoolESProducer.cff"

# Pattern Recognition and Fit
include "RecoTracker/TrackProducer/data/CTFFinalFitWithMaterial.cff"
include "RecoTracker/CkfPattern/data/CkfTrackCandidates.cff"
include "TrackingTools/TrajectoryFiltering/data/TrajectoryFilter.cff"

##FILTER
es_module nuclearCkfTrajectoryFilter = trajectoryFilterESProducer from "TrackingTools/TrajectoryFiltering/data/TrajectoryFilterESProducer.cfi"
replace nuclearCkfTrajectoryFilter.ComponentName = "nuclearCkfTrajectoryFilter"
replace nuclearCkfTrajectoryFilter.filterPset.minPt = 0.3
replace nuclearCkfTrajectoryFilter.filterPset.maxLostHits  = 1
replace nuclearCkfTrajectoryFilter.filterPset.minimumNumberOfHits = 3

##TRAJECTORY BUILDER
es_module nuclearCkfTrajectoryBuilder = CkfTrajectoryBuilder from "RecoTracker/CkfPattern/data/CkfTrajectoryBuilderESProducer.cfi"
replace nuclearCkfTrajectoryBuilder.ComponentName = "nuclearCkfTrajectoryBuilder"
replace nuclearCkfTrajectoryBuilder.trajectoryFilterName = "nuclearCkfTrajectoryFilter"
replace nuclearCkfTrajectoryBuilder.alwaysUseInvalidHits = false


##TRACK CANDIDATES
module nuclearTrackCandidates =
   ckfTrackCandidates from "RecoTracker/CkfPattern/data/CkfTrackCandidates.cfi"
replace nuclearTrackCandidates.SeedProducer= "nuclearSeed"
replace nuclearTrackCandidates.TrajectoryBuilder = "nuclearCkfTrajectoryBuilder"
replace nuclearTrackCandidates.RedundantSeedCleaner = "none"


##TRACKS
module nuclearWithMaterialTracks = 
  ctfWithMaterialTracks from "RecoTracker/TrackProducer/data/CTFFinalFitWithMaterial.cfi"
replace  nuclearWithMaterialTracks.src ="nuclearTrackCandidates"       
replace FittingSmootherRK.MinNumberOfHits = 3


include "RecoTracker/NuclearSeedGenerator/data/NuclearSeed.cfi"

include "RecoVertex/NuclearInteractionProducer/data/NuclearInteraction.cfi"

include "RecoTracker/NuclearSeedGenerator/data/NuclearTrackCorrector.cfi"


sequence nuclear_interaction = { nuclearSeed, nuclearTrackCandidates, nuclearWithMaterialTracks, nuclearInteractionMaker }
sequence nuclear_interaction_and_correction = { nuclear_interaction, TrackCorrector } 
